## I/O
  概念: 输入是指数据从外部环境（如用户、传感器、网络或其他计算机）进入计算机，而输出是指数据从计算机传输到外部环境。 按信息交换的单位可分为块设备和字节设备<br/>
  
### I/O控制器
  功能: 1) 接受和识别CPU发出的命令: 有相应的控制寄存器来存放命令和参数 <br/>
  2) 向CPU报备设备的状态: 有状态寄存器来存放I/O设备当前的状态 <br/>
  3) 数据交换: 有数据寄存器来暂存数据 <br/>
  4) 地址识别: 区分各个寄存器, io里面寄存器的两种编址方式(内存映射IO和端口映射IO)<br/>
  组成: <img width="600" alt="1684073056006" src="https://github.com/Leavaway/csnotes/assets/86211987/1a75fad6-714d-4f3b-9464-6cbdb07ef354"><br/>
### I/O控制方式
  1. 程序直接控制方式: CPU干预频率高 CPU和IO设备串行工作导致利用率低<br/>
  <img width="600" alt="1684078036492" src="https://github.com/Leavaway/csnotes/assets/86211987/4d31ad6b-3825-4e46-a809-c265d93234a0"><br/>
  2. 中断驱动方式: 引入了中断机制, 可以并行工作, 但是每个字在I/0设备与内存之间的传输，都需要经过CPU。而频繁的中断处理会消耗较多的CPU时间<br/>
  <img width="600" alt="1684078404522" src="https://github.com/Leavaway/csnotes/assets/86211987/59bc968a-1cbb-49c7-a128-586413620eb1"><br/>
  3. DMA(Direct memory access): 主要用于块设备的IO控制, 仅在传输一个或者多个数据块(连续的)的开始和结束时才需要CPU干预<br/>
  <img width="600" alt="1684078806335" src="https://github.com/Leavaway/csnotes/assets/86211987/4a30de80-c910-4035-b3b5-200857140c2f"><br/>
  4. 通道控制方式: 使用通道(一种硬件)识别并执行一系列通道指令, 通道程序放在内存中, CPU指明通道程序位置和操作设备等信息就不再干预, 可以一次读写一组数据块, 且并行度高<br/>
### I/O软件层次结构
  自下而上: <br/>
  中断处理程序：这是 I/O 软件结构中最底层的部分，负责响应硬件设备产生的中断。当一个 I/O 操作完成时，设备会产生一个中断，中断处理程序会保存当前的 CPU 状态，处理中断，然后   恢复 CPU 状态。<br/>
  设备驱动程序：设备驱动程序是操作系统的一部分，负责管理和控制具体的硬件设备。它提供了一个统一的接口，使得上层的软件无需了解具体的硬件细节就可以操作设备。<br/>
  设备独立的 I/O 软件：这一层的软件负责提供设备独立的 I/O 接口，它将具体的设备驱动程序抽象成一个统一的设备模型。例如，它可能将所有的磁盘驱动程序抽象成一个统一的磁盘模型。   <br/>
  用户空间的 I/O 软件：这一层的软件运行在用户空间，提供了一些用于 I/O 操作的库函数，如 C 语言的标准 I/O 库。<br/>
  应用程序：应用程序是 I/O 软件结构的最顶层，它直接与用户交互d，使用上述各层提供的接口和服务来完成 I/O 操作。<br/>
  <img width="600" alt="1684131112654" src="https://github.com/Leavaway/csnotes/assets/86211987/ffd99ca5-44e5-4ed8-8bd3-d862a66d07c5"><br/>
### 接口
  输出/输出应用程序接口: 字符设备接口, 块设备接口, 网络设备接口 分别提供了get/put  read/write  bind/connect/read/write等接口
  阻塞IO和非阻塞IO的区别在于是否会让进程转为阻塞态等待
  socket: <br/>
  <img width="781" alt="1684154943071" src="https://github.com/Leavaway/csnotes/assets/86211987/96e0922e-8399-45e1-b4d7-be05254d1217"><br/>
  设备驱动程序接口: 设备独立软件通过这个接口调用驱动程序
### I/O核心子系统
  假脱机技术: 把独占性设备变成虚拟的共享设备<br/>
      实现方法: 1) 在用户进程申请打印机的时候为进程在输出井申请一个空闲缓冲区, 将任务放进去然后创建一份打印请求表并且将其挂到假脱机队列上<br/>
  设备独立性软件: 负责I/O调度, 设备保护等功能,设备分配与回收, 缓冲区管理<br/>
  设备的分配与回收: 从进程运行的安全性上考虑，设备分配有两种方式:安全分配方式:为进程分配一个设备后就将进程阻塞，本次I/O完成后才将进程唤醒一个时段内每个进程只能使用一个设备 <br/>
        优点:破坏了“请求和保持”条件，不会死锁缺点:对于一个进程来说，CPU和I/0设备只能串行工作<br/>
     不安全分配方式: 不阻塞进程但是可能导致死锁(可以使用银行家算法等)<br/>
  设备分配流程: 用户或应用程序发出一个设备请求，如打印一个文件。这个请求通常会指定一个逻辑设备名，如"打印机1"。<br/>
               操作系统内核会查询逻辑设备表（LUT），找到与指定的逻辑设备名对应的设备驱动程序。<br/>
               设备驱动程序接管后，它会查询系统设备表（SDT）以获取物理设备的详细信息，包括设备控制器的地址。<br/>
               设备驱动程序使用从SDT获取的信息，通过设备控制器向设备发出操作指令。<br/>
               如果设备通过一个I/O通道进行访问，设备驱动程序会通过通道控制器（如果有的话）发出指令。设备控制器和通道控制器可能有自己的控制表，如设备控制表（DCT）和通道控制表（CHCT）。<br/>
  缓冲区管理: 1) 单缓冲: 假设某用户进程请求某种块设备读入若干块的数据。若采用单缓冲的策略，操作系统会在主存中为其分配一个缓冲区<br/>
             2) 双缓冲: 对比于单缓冲额外分配了一个缓冲区<br/>
             3) 循环缓冲区: 将多个大小相等的缓冲区连接成一个缓冲队列, 使用2个指针管理队列<br/>
             4) 缓冲池: 由系统中公共的缓冲区组成, 缓冲区按照使用状况分成空缓冲队列, 输入队列, 输出队列, 根据实际功能不同又分为sin hin hout sout<br/>
### 磁盘
  磁盘是一种数据存储设备，它使用磁性材料进行数据的读写。有两种主要类型的磁盘：硬盘驱动器（Hard Disk Drive，HDD）和固态硬盘（Solid State Drive，SSD）。<br/>
  磁盘调度算法: 先来先服务, 最短寻找优先, 扫描算法, 循环扫描算法<br/>
  交替编号(因为读完一块扇区后有一定延迟时间, 如果连着放的话不能连着读)和错位命名(原理同交替编号)和柱面号盘面号扇区号(可以减少磁头移动) 这些都可以减少延迟时间。<br/>
  固态硬盘: <img width="600" alt="1684573923963" src="https://github.com/Leavaway/csnotes/assets/86211987/ce48a84b-dfbe-47b3-8995-f572166f5c06"><br/>
